/*! ractive-graph 0.1.0 2015-06-02 */
Ractive.components.graph=Ractive.extend({isolated:!0,data:{width:"100%",height:"500px"},template:"<div id='{{id}}' style='position: relative; width: {{width}}; height: {{height}};' class='{{class}}'>{{yield}}</div>",onconfig:function(){this.edges={}},onrender:function(){function a(a,d){var e=a.clientX-b.dragged.dx,f=a.clientY-b.dragged.dy;0>e?e=0:e>c.clientWidth-b.dragged.width&&(e=c.clientWidth-b.dragged.width),0>f?f=0:f>c.clientHeight-b.dragged.height&&(f=c.clientHeight-b.dragged.height),d?b.dragged.node.set({x:e,y:f}):(b.dragged.elem.style.left=e+"px",b.dragged.elem.style.top=f+"px");var g=b.edges[b.dragged.id];if(g)for(var h in g)g[h].update(d)}var b=this,c=b.find("*");c.addEventListener("mouseup",function(c){b.dragged&&(a(c,!0),b.dragged.elem.style.zIndex=2,b.dragged=null,c.stopPropagation())}),c.addEventListener("mouseleave",function(c){b.dragged&&(a(c,!0),b.dragged.elem.style.zIndex=2,b.dragged=null,c.stopPropagation())}),c.addEventListener("mousemove",function(c){b.dragged&&(a(c,!1),c.stopPropagation())})}}),Ractive.components.node=Ractive.extend({isolated:!0,data:{draggable:!0},template:"<div id='node_{{id}}' class='{{class}}' style='position: absolute; z-index: 2; left: {{x}}px; top: {{y}}px; {{style}}' onclick='{{onclick}}'>{{yield}}</div>",onrender:function(){var a=this,b=a.find("*"),c=this.container;b.addEventListener("mousedown",function(d){a.get("draggable")&&(b.style.zIndex=3,c.dragged={node:a,id:a.get("id"),elem:b,dx:d.clientX-b.offsetLeft,dy:d.clientY-b.offsetTop,width:b.offsetWidth,height:b.offsetHeight},d.preventDefault(),d.stopPropagation())})}}),Ractive.components.edge=Ractive.extend({isolated:!0,template:"<svg style='position: absolute; z-index: 1; display: inline-block; width: 100%; height: 100%; pointer-events: none;' ><line x1='{{x1}}' y1='{{y1}}' x2='{{x2}}' y2='{{y2}}' class='{{class}}' style='pointer-events: auto; {{style}}' onclick='{{onclick}}' /></svg><span style='position: absolute; z-index: 2;'>{{yield}}</span>",oninit:function(){var a=this.get("from"),b=this.get("to");if(a&&b){var c=this.container;c.edges[a]?c.edges[a].push(this):c.edges[a]=[this],c.edges[b]?c.edges[b].push(this):c.edges[b]=[this]}},onrender:function(){var a=document.getElementById("node_"+this.get("from")),b=document.getElementById("node_"+this.get("to"));if(a&&b){var c=this,d=(this.find("svg"),this.find("line")),e=this.find("span");this.update=function(f){var g={x1:a.offsetLeft+a.offsetWidth/2,x2:b.offsetLeft+b.offsetWidth/2,y1:a.offsetTop+a.offsetHeight/2,y2:b.offsetTop+b.offsetHeight/2};f?c.set(g):(d.setAttribute("x1",g.x1),d.setAttribute("x2",g.x2),d.setAttribute("y1",g.y1),d.setAttribute("y2",g.y2)),e.style.left=(g.x1+g.x2-e.offsetWidth)/2+"px",e.style.top=(g.y1+g.y2-e.offsetHeight)/2+"px"},this.update(!0)}},onteardown:function(){function a(a,b){if(a&&b){var c=b.indexOf(a);c>=0&&b.splice(c,1)}}var b=this.get("from"),c=this.get("to");if(b&&c){var d=this.container;a(this,d.edges[b]),a(this,d.edges[c])}}});